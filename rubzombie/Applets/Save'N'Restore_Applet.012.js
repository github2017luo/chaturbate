javascript:/*** CB app/bot data Save'n'restore bookmarklet v2.010 ***/window.__nativeST__=window.__nativeST__||window.setTimeout;window.__nativeSI__=window.__nativeSI__||window.setInterval;window.setTimeout=function(a,g){var h=this,v=Array.prototype.slice.call(arguments,2);return window.__nativeST__(a instanceof Function?function(){a.apply(h,v)}:a,g)};window.setInterval=function(a,g){var h=this,v=Array.prototype.slice.call(arguments,2);return window.__nativeSI__(a instanceof Function?function(){a.apply(h,v)}:a,g)}; (function(a,g,h,v){function n(c,b){b=b||0;c[b++](function(c,b){return function(){b<c.length&&a.setTimeout(function(){n(c,b)},1)}}(c,b))}a.CBS={version:"CBS::v2::CB app/bot data Save/restore::20171104.012::Debug"};h=h||"1";v=v||function(a,c,b,f,e){setTimeout(e,1E4,a,c,b,f)};var b=g.getElementById("CBSv2Overlay"),c=[],f,k=!1,e,p=!1,D,x;/(github|camgasm|chaturbate)\.(io|com)$/i.test(g.location.hostname)?b||n([function(a){var f="<style>.CBSv2-no-overflow {overflow:hidden!important;outline:0;}${visibility:visible;position:fixed;top:0;right:0;left:0;bottom:0;overflow-y:auto;padding:0;z-index:10;background-color:rgba(0,0,0,0.05);}$ div {visibility:visible;width:300px;margin:100px auto;background-color:#fff;border:1px solid #000;padding:15px;text-align:center;}</style>".replace(/\$/g, "#CBSv2Overlay");console.log(">do overlay and splash screen");b=g.createElement("div");b.setAttribute("id","CBSv2Overlay");b.style.display="block";b.innerHTML=f+"<div>Starting...</div>";g.body.appendChild(b);g.body.classList.add("CBSv2-no-overflow");c.push(b);setTimeout(function(){a()},1E3)},function(c){console.log(">do jquery load");(f=a.jQuery)&&h<=f.fn.jquery?c():(b=g.createElement("script"),b.type="text/javascript",b.src="//ajax.googleapis.com/ajax/libs/jquery/"+h+"/jquery.min.js",b.onload=b.onreadystatechange= function(){x=this.readyState;k||x&&"loaded"!==x&&"complete"!==x||((f=a.jQuery).noConflict(k=!0),console.log("loaded1: "+b.src),b.onload=b.onreadystatechange=null,c())},g.documentElement.childNodes[0].appendChild(b))},function(a){console.log(">do stylesheet load(s)");[["//cdn.jsdelivr.net/alertifyjs/1.4.1/css/alertify.min.css","alertify-notifier ajs-left","left","10px"],["//cdn.jsdelivr.net/alertifyjs/1.4.1/css/themes/default.min.css","alertify-default","left","10px"],["//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css", "fa","font-family","FontAwesome"]].forEach(function(a){console.log("forEach: "+a[0]);(function(a,c,b,e){c=f("<div>").hide().css({height:0,width:0}).addClass(c||"").appendTo("body");b=c.css(b||"")===e;c.remove();return f('link[rel="stylesheet"][href$="'+a.match(/(?:\/)[^\/]+$/)+'"]').length&&b}).apply(null,a)||(b=g.createElement("link"),b.setAttribute("rel","stylesheet"),b.setAttribute("href",a[0]),g.head.appendChild(b),console.log("loaded2: "+a[0]))});a()},function(c){console.log(">do alertifyjs load"); (e=a.alertify)&&e.dialog?c():(b=g.createElement("script"),b.src="//cdn.jsdelivr.net/alertifyjs/1.4.1/alertify.min.js",b.onload=b.onreadystatechange=function(){x=this.readyState;p||x&&"loaded"!==x&&"complete"!==x||(D=a.alertify,a.alertify=e,e=D,p=!0,console.log("loaded3: "+b.src),b.onload=b.onreadystatechange=null,c())},g.documentElement.childNodes[0].appendChild(b))},function(a){console.log(">clear splash screen, after 3s delay");setTimeout(function(){var a=g.querySelector("#CBSv2Overlay div");a&& (a.style.visibility="hidden")},3E3);a()},function(a){console.log(">run app");v(f,k,e,p,a)},function(a){console.log(">schedule alertifyjs remnants removal");p&&setTimeout(function(){Array.prototype.slice.call(g.querySelectorAll('div[class*="alertify-"],div[class*="ajs-"]')).forEach(function(a){a.parentElement.removeChild(a)})},2E3);a()},function(a){console.log(">do final cleanup, remove any added script and link tags");c.forEach(function(a){a.parentNode.removeChild(a)});g.body.classList.remove("CBSv2-no-overflow"); a()}]):a.alert("*chaturbate.com, *.camgasm.com and github.io only bookmarklet")})(window,document,"1.6.4",function(a,g,h,v,n){function b(){return window.ws_handler&&window.ws_handler.connected||window.websocket_handler&&window.websocket_handler.connected||window.flash_handler&&window.flash_handler.connected||window.html_handler&&window.html_handler.connected}function c(){var d=new Date,a=/(..)(:..)(:..)/.exec(d),c=a[1]% 12||12;return" "+(10>c?"0"+c:c)+a[2]+a[3]+" "+(12>a[1]?"A":"P")+"M "+d.getTime().toString().slice(-3)} function f(d){w.empty().append(R,a("<p>"+d+"</p>"));z&&z.isOpen()&&z.setContent(w[0]).set("closable",!0)}function k(){console.log(c()+": closeDialog",z,z.isOpen());z&&z.isOpen()&&z.close().set("closable",!0)}function e(d){h.success(d).callback=k}function p(d){h.error(d).callback=k}function D(d){console.log(c()+"> "+JSON.stringify(window.CBSv2_ping)+" | "+JSON.stringify(d));var b=N[window.CBSv2_ping.split("/").length],m;window.$message_sender.confirmed_send=!0;void 0!==(m=window.flash_handler)&&m.connected? (m.consolelog("User is sending message: "+d),d=a.toJSON({m:d,c:"",f:""}),m.consolelog(d),window.GetFlashObject("movie").SendRoomMsg(d)):void 0!==(m=window.html_handler)&&m.connected?(m.consolelog("User is sending message: "+d),d=a.toJSON({m:d,c:"",f:""}),m.consolelog(d),a.ajax({url:m.post_address,dataType:"json",data:{room:m.room_owner_nick,message:d,username:m.user},type:"POST",success:function(a){if(""===a)p("An error occurred");else if(a["X-Spam"])m.message_inbound.on_room_message(m.user,d)}})): void 0!==(m=window.websocket_handler)&&m.connected?m.connection.send(JSON.stringify({action:"msg",msg:d})):void 0!==(m=window.ws_handler)&&m.connected?(m.consolelog("User is sending message: "+d),d=a.toJSON({m:d,c:"",f:""}),m.consolelog(d),m.SendRoomMsg(d)):(console.log(c()+': "'+b+'" Failed. Not connected.'),window.CBSv2_autosave_interval?l.enm():f(b+" Failed. Chat may be disconnected."))}function x(){var d=a('.stop_link[name="/app/stop/'+this.idx+'/"]');this[this.idx]=d.length?d[0].parentNode.previousElementSibling.innerHTML.trim(): "";this[this.idx].length&&b()?(window.CBSv2_ping=["","#"+this.idx+"CBSv2",I,""].join("/"),D(window.CBSv2_ping),C=setTimeout.call(this,function(){this[this.idx]="";this.enm()},5E3)):this.enm()}function P(){var a=N[window.CBSv2_ping.split("/").length];C=null;console.log(c()+': "'+a+'" Failed. Post timed-out.');window.CBSv2_autosave_interval?l.enm():f(a+" Failed. Chat may be unresponsive.")}function L(a,c){c=c||0;var d=A.slice(c,c+512);window.CBSv2_ping=["","#"+a+"CBSv2",I,c,d,d.length,""].join("/"); D(window.CBSv2_ping);C=setTimeout(P,5E3)}function M(a,c){window.CBSv2_ping=["","#"+a+"CBSv2",I,c||0,""].join("/");D([window.CBSv2_ping,""].join("/"));C=setTimeout(P,5E3)}function W(){this[this.idx].length&&b()&&window.CBSv2_autosave_interval?(console.log(c()+': AutoSave "'+B[this.idx]+'"'),M(this.idx)):this.enm()}function y(d){function b(){console.log(c()+": AutoSave: onAutoSaved: retry: "+y.b);y.a?--y.b?setTimeout(b,1E3):(console.log(c()+": AutoSave: onAutoSaved: Failed. retry timed-out."),d.call(this)): d.call(this)}window.CBSv2_autosave_interval?y.a?d&&(y.b=5,setTimeout(b,1E3)):(y.a=!0,a("#CBSv2Overlay").length?console.log(c()+"! Missed AutoSave. CBS Menu open."):(console.log(c()+": AutoSave: "+JSON.stringify(l)),l.enm(x,function(){I=(new Date).valueOf();l.enm(W,function(){y.a=!1;d&&d.call(this)})}))):d&&d.call(this)}function Q(){var a,c;r=[];for(c=0;c<u.length;c++){for(a=u.key(c).split("/");4<a.length;)a[1]=[a[1]].concat(a.splice(2,1)).join("/");4===a.length&&"CBSv2"===a[0]&&r.push(a.concat(u.key(c), [a[1],(new Date(parseInt(a[3],10))).toLocaleString(),B[parseInt(a[2],10)]].join(" ")))}}function X(a,b,m,f,e,q,t){console.log(c()+": onRestore: hdr, ts: ",a,m);a=parseInt(b[1],10);console.log(c()+": onRestore: ",e.length,q,t);e?L(a,parseInt(f,10)+parseInt(t,10)):k()}function Y(a){document.body.removeChild(a.target)}function Z(a){var c=document.createElement("input");c.type="file";c.onchange=function(c){var d=c.target.files[0],b=new window.FileReader;b.onload=function(c){c=JSON.parse(c.target.result); for(var b=(c.key||"").split("/");4<b.length;)b[1]=[b[1]].concat(b.splice(2,1)).join("/");4===b.length&&"CBSv2"===b[0]&&b[1]===l[a]?(A=c.value,L(a)):alert('"'+d.name+'" does not contain "'+l[a]+'" save data.')};b.readAsText(d,"UTF-8");c.target.parentNode&&c.target.parentNode.removeChild(c.target)};null===window.webkitURL&&(c.style.display="none",document.body.appendChild(c));c.click()}function aa(a,b,m,H,g,q){function d(){var a=["CBSv2",l[E],E,m].join("/");console.log(c()+": onSave: "+(window.CBSv2_autosave_interval? "Auto":"")+"Saved.");if("false"!==u.CBSv2_use_local_storage)u[a]=A,window.CBSv2_autosave_interval?l.enm():e("Saved.");else{var d=new window.Blob([JSON.stringify({key:a,value:A})],{type:"application/json"}),b=document.createElement("a");b.download=a.split("/").slice(0,-1).join("_")+".json";b.innerHTML="Download File";null!==window.webkitURL?b.href=window.webkitURL.createObjectURL(d):(b.href=window.URL.createObjectURL(d),b.onclick=Y,b.style.display="none",document.body.appendChild(b));b.click();k()}} function J(){u.removeItem(r[h][4]);d()}console.log(c()+": onSave: hdr, ts: ",a,m);var E=parseInt(b[1],10),h=-1;console.log(c()+": onSave: ",g.length,parseInt(q,10));A="0"===H?g:A+g;if(g)M(E,A.length);else if(A.length)if("false"!==u.CBSv2_use_local_storage){window.CBSv2_autosave_interval&&Q();for(a=0;a<r.length;a++)if(b[1]===r[a][2]&&l[E]===r[a][1]){h=a;break}-1<h?window.CBSv2_autosave_interval?J():F("Confirm Overwrite...",'Overwrite existing "'+r[h][5]+'" saved data?',J,function(){console.log(c()+ ": Overwrite cancelled.");p("Overwrite cancelled.")}):d()}else d();else console.log(c()+": onSave: null data"),window.CBSv2_autosave_interval?l.enm():f('No Data. "'+l[E]+'" did not respond with data to save.')}function K(a){C&&(clearTimeout(C),C=null);console.log(c()+": onData: ",JSON.stringify(a));var b=N[window.CBSv2_ping.split("/").length];a=a.split("/");var d=parseInt(a[1][1],10);""===a[a.length-1]?4===a.length?(l[d]="",l.enm()):(console.log(c()+': "'+b+'" Failed. No Response'),f(b+' Failed. "'+ l[d]+'" did not respond to "'+b+'" command.')):4===a.length?l.enm():6===a.length?aa.apply(this,a):7===a.length?X.apply(this,a):(console.log(c()+": Houston, we have a problem!"),window.CBSv2_autosave_interval?(console.log(c()+': "'+l[d]+'" gave an unknown response to "AutoSave" command.'),l.enm()):f(b+' Aborted. "'+l[d]+'" gave an unknown response to "'+b+'" command.'))}function ca(a){function b(){console.log(c()+": Delete ALL cancelled.");p("Delete ALL cancelled.")}var d;z.set("closable",!1);a.html("Processing..."); switch(a.attr("class")){case "da":console.log(c()+": Delete ALL");F("Confirm Delete ALL...","Delete ALL saved data?",function(){F("Confirm Confirm Delete ALL...","Are you really sure you want to Delete ALL saved data?",function(){for(d=0;d<r.length;d++)u.removeItem(r[d][4]);e("ALL Deleted.")},b)},b);break;case "ld":console.log(c()+': Restore "'+a.data("k")+'" to "'+a.data("s")+'"');A=u[r[a.data("i")][4]];L(B.indexOf(a.data("s")));break;case "lf":console.log(c()+': Restore file to "'+a.data("s")+'"'); Z(B.indexOf(a.data("s")));k();break;case "rm":console.log(c()+': Delete "'+a.data("k")+'"');F("Confirm Delete...",'Delete "'+r[a.data("i")][5]+'" saved data?',function(){u.removeItem(a.data("k"));e("Deleted.")},function(){console.log(c()+": Delete cancelled.");p("Delete cancelled.")});break;case "sv":console.log(c()+': Save "'+a.data("s")+'"'),M(B.indexOf(a.data("s")))}}function G(a,c){function b(a,c){var b=c.split("."),d,q=b.length;for(d=0;d<q;d++){if(void 0===a||!a.hasOwnProperty(b[d]))return null; a=a[b[d]]}return a}var d=a.split("."),e=d[d.length-1],q=b(window,d[0]);d=b(window,d.slice(0,-1).join("."));if(q&&d&&d.hasOwnProperty(e)&&"function"===typeof d[e]){var t=d[e].CBS_orig;"function"!==typeof t&&(t=d[e]);d[e]=c;d[e].CBS_orig=t;d[e].CBS_root=q}else console.error("failed to subclass: ",a)}function O(){a(".stop_link").unbind("click").click(function(){var c=this;y(function(){a.ajax({url:a(c).attr("name"),dataType:"text",data:"",type:"POST",success:function(){a.mydefchatconn("app_tab_refresh")}})})})} function T(a){return'<i class="'+a+'" style="vertical-align:middle; margin-right:20px;"></i>'}console.log("jQuery loaded: ",g," AlertifyJS loaded: ",v);var z,w=a("<div class=CBSv2_buttons></div>"),R=a("<style>.$_buttons{margin:0 auto;padding:10px 20px;}.$_buttons button{display:block;width:100%;margin:5px 0;}.$_buttons input[type=checkbox][disabled] + label{color: #ccc;}</style>".replace(/\$/g,"CBSv2")),B=["Active App","Bot #1","Bot #2","Bot #3"],l=["","","",""],N={4:"Query",6:"Save",7:"Restore"}, u=window.localStorage,r,A,C=null,U=/^\/#[0-3]CBSv2\//;window.CBSv2_autosave_interval=window.CBSv2_autosave_interval||null;window.CBSv2_autosave_interval&&(window.clearInterval(window.CBSv2_autosave_interval),console.log(c()+": AutoSave suspended"));window.CBSv2_ping=window.CBSv2_ping||null;Array.prototype.enm=Array.prototype.enm||function(a,c){this.idx=++this.idx||0;arguments.length&&(this.fn=a||null,this.cb=c||null);this.idx<this.length?this.fn&&this.fn.call(this):(delete this.idx,this.cb&&this.cb.call(this))}; h.set("notifier","delay",3);G("flash_handler.message_inbound.on_room_message",function H(b,e){var f=H.CBS_root,q=unescape(e);try{var t=a.parseJSON(q)}catch(J){console.error(J.message),t={m:q}}q=f.striphtml(t.m).replace(/\s*/g,"");console.log(c()+"< "+JSON.stringify(window.CBSv2_ping)+" | "+JSON.stringify(q));return 0===q.indexOf(window.CBSv2_ping)?(f.sanitize(b)===f.room&&K(q),!0):H.CBS_orig.call(this,b,e)});G("html_handler.message_inbound.on_room_message",function q(a,b,e){var t=q.CBS_root,f=t.striphtml(b.m).replace(/\s*/g, "");if(0===f.indexOf(window.CBSv2_ping))return console.log(c()+"< "+JSON.stringify(window.CBSv2_ping)+" | "+JSON.stringify(f)),(t.sanitize(a)||t.sanitize(b.user))===t.room&&K(f),!0;if(U.test(f))return console.log(c()+"? "+JSON.stringify(window.CBSv2_ping)+" | "+JSON.stringify(f)),!0;console.log(c()+"< "+JSON.stringify(f));return q.CBS_orig.call(this,a,b,e)});G("websocket_handler.message_inbound.on_room_message",function S(a){if(void 0===a.m)return!0;var b=S.CBS_root,e=b.striphtml(a.m).replace(/\s*/g, "");if(0===e.indexOf(window.CBSv2_ping))return console.log(c()+"< "+JSON.stringify(window.CBSv2_ping)+" | "+JSON.stringify(e)),b.sanitize(a.user)===b.room&&K(e),!0;if(U.test(e))return console.log(c()+"? "+JSON.stringify(window.CBSv2_ping)+" | "+JSON.stringify(e)),!0;console.log(c()+"< "+JSON.stringify(e));return S.CBS_orig.call(this,a)});G("ws_handler.message_inbound.on_room_message",function t(b,e){var q=t.CBS_root,f=e;try{var g=a.parseJSON(f)}catch(ba){console.error(ba.message),g={m:f}}f=q.striphtml(g.m).replace(/\s*/g, "");console.log(c()+"< "+JSON.stringify(window.CBSv2_ping)+" | "+JSON.stringify(f));return 0===f.indexOf(window.CBSv2_ping)?(q.sanitize(b)===q.room&&K(f),!0):t.CBS_orig.call(this,b,e)});G("jQuery.mydefchatconn",function t(a){"app_tab_refresh"!==a&&"update_panel"!==a||console.log('$.mydefchatconn("'+a+'")');return t.CBS_orig.apply(this,arguments)});b()&&(a('.info-user a[data-tab="apps_and_bots"]').unbind("click").click(function(){var c=a(".info-user div.apps_and_bots"),b=a(".info-user .buttons a[data-tab='apps_and_bots']").attr("href"); c.show();c.html(window.gettext("loading . . ."));O?c.load(b,O):c.load(b)}),O());if(!F){h.dialog("CBSv2Confirm",function(){return{build:function(){this.setting("defaultFocus","cancel")},prepare:function(){this.setHeader("<span style=\"color:#dc5500; font-family: 'UbuntuBold', Arial, Helvetica, sans-serif;\">"+T("fa fa-exclamation-triangle fa-2x")+"CBSv2: "+this.get("title")+"</span>")}}},!0,"confirm");var F=h.CBSv2Confirm}if(!V){h.dialog("CBSv2Alert",function(){return{build:function(){this.setHeader("<span style=\"color:#dc5500; font-family: 'UbuntuBold', Arial, Helvetica, sans-serif;\">"+ T("fa fa-cog fa-2x")+"CBSv2: CB app/bot data Save'n'restore bookmarklet v2</span>")},setup:function(){return{buttons:[{text:"Close",key:27}],focus:{element:0},options:{maximizable:!1,resizable:!1,padding:!1}}},prepare:function(){var b=a(".CBSv2_buttons button");"false"!==u.CBSv2_use_local_storage?b.filter(".lf").hide():(a("#CBSv2_as").prop("disabled",!0),b.filter(".ld, .rm, .da").hide());a('.chat-box ul.buttons li a[data-tab="autosave"]').length&&b.filter(".sv, .ld, .lf").prop("disabled",!0);b.click(function(c){c.preventDefault(); b.prop("disabled",!0);ca(a(this))});a("#CBSv2_ls").change(function(){var c=a('.chat-box ul.buttons li a[data-tab="autosave"]').length;u.CBSv2_use_local_storage=a(this).is(":checked");"false"!==u.CBSv2_use_local_storage?(a("#CBSv2_as").prop("disabled",!1),b.filter(".ld").prop("disabled",c),b.filter(".ld, .rm, .da").show(),b.filter(".lf").hide()):(a("#CBSv2_as").prop("disabled",!0),b.filter(".ld, .rm, .da").hide(),b.filter(".lf").prop("disabled",c),b.filter(".lf").show(),a("#CBSv2_as").removeProp("checked").change())}); a("#CBSv2_as").change(function(){a(this).is(":checked")?(console.log(c()+": AutoSave On"),a('.chat-box ul.buttons li a[data-tab="settings"]').parent().before(a("<li></li>").html('<a href="#" data-tab="autosave" class="nooverlay">AutoSave</a>')),b.filter(".sv, .ld, .lf").prop("disabled",!0)):(console.log(c()+": AutoSave Off"),a('.chat-box ul.buttons li a[data-tab="autosave"]').parent().remove(),b.filter(".sv, .ld, .lf").prop("disabled",!1))})},hooks:{onclose:function(){a('.chat-box ul.buttons li a[data-tab="autosave"]').length? (window.CBSv2_autosave_interval=setInterval(y,6E4),console.log(c()+": AutoSave activated"),setTimeout(y,6E3)):window.CBSv2_autosave_interval=null;a(".CBSv2_buttons").remove();n()}}}},null,"alert");var V=h.CBSv2Alert}var I=(new Date).valueOf();l.enm(x,function(){var e;var f=l.some(function(a){return a});var g=b();console.log(c()+": apps: "+JSON.stringify(l));w.append(R);Q();if(r.length||f&&g){for(e=0;e<l.length;e++)if(l[e]&&g){var h=a('<button data-s="^" data-a="$" class="sv">Save ^ "$" data</button>'.replace(/\^/g, B[e]).replace(/\$/g,l[e]));w.append(h);h=a('<button data-s="^" data-a="$" class="lf">Restore ^ "$" saved data from file</button>'.replace(/\^/g,B[e]).replace(/\$/g,l[e]));w.append(h);for(f=0;f<r.length;f++)if(l[e]===r[f][1]){var k=r[f][4];h=a(('<button data-s="^" data-i="'+f+'" data-k="'+k+'" class="ld">Restore "'+r[f][5]+'" saved data into ^</button>').replace(/\^/g,B[e]));w.append(h)}}for(f=0;f<r.length;f++)h=a('<button data-i="'+f+'" data-k="'+k+'" class="rm">Delete "'+r[f][5]+'" saved data</button>'), w.append(h);1<r.length&&(h=a('<button class="da">Delete ALL saved data</button>'),w.append(h));h=a('<input type="checkbox" id="CBSv2_ls"><label for="CBSv2_ls">Use browser Local Storage</label>');"false"!==u.CBSv2_use_local_storage&&h.prop("checked",!0);w.append(h);g&&(h=a('<input type="checkbox" id="CBSv2_as"><label for="CBSv2_as">AutoSave</label>'),a('.chat-box ul.buttons li a[data-tab="autosave"]').length&&h.prop("checked",!0),w.append(h))}else w.append(a("<p>Nothing to do!</p>")),console.log(c()+ ": "+JSON.stringify({"saves.length":r.length,bSomeCBSApps:f,bInChat:g}));z=V(w[0])})}); 
